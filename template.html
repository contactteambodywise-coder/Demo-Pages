<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate 3D + HTML Page Builder (Mobile Friendly)</title>
<style>
/* ========== LAYOUT ========== */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: row;
  height: 100vh;
}

#controls {
  background: #444;
  color: white;
  padding: 10px;
  width: 200px;
  overflow-y: auto;
  flex-shrink: 0;
}

#controls button {
  padding: 5px 10px;
  margin: 2px 0;
  cursor: pointer;
  border: none;
  border-radius: 4px;
  background: #1E90FF;
  color: white;
}

#controls button:hover {
  background: #0b6fc2;
}

#builder {
  flex: 1;
  background: #f0f0f0;
  position: relative;
  overflow: auto;
}

.element-box {
  border: 1px dashed #888;
  padding: 10px;
  margin: 5px;
  background: #fafafa;
  position: absolute;
  cursor: grab;
}

.element-box.selected {
  border: 2px solid #ff8c00;
}

.element-box button.remove {
  position: absolute;
  top: 5px;
  right: 5px;
  background: red;
  color: white;
  border: none;
  padding: 2px 5px;
  cursor: pointer;
}

input, textarea, select {
  width: 100%;
  margin: 3px 0;
  padding: 3px;
}

#sidePanel {
  width: 250px;
  background: #eee;
  padding: 10px;
  overflow-y: auto;
  flex-shrink: 0;
}

canvas {
  display: block;
  width: 100%;
  height: 100%;
}

/* ========== MOBILE FRIENDLY ========== */
@media (max-width: 900px) {
  body {
    flex-direction: column;
  }
  #controls, #sidePanel {
    width: 100%;
    height: auto;
  }
  #builder {
    height: 60vh;
  }
}
</style>
</head>
<body>

<!-- LEFT PANEL: Add HTML & 3D elements -->
<div id="controls">
  <h3>HTML Elements</h3>
  <button onclick="addElement('h1')">Heading H1</button>
  <button onclick="addElement('p')">Paragraph</button>
  <button onclick="addElement('img')">Image</button>
  <button onclick="addElement('button')">Button</button>
  <button onclick="addElement('a')">Link</button>
  <button onclick="addElement('ul')">Unordered List</button>
  <button onclick="addElement('ol')">Ordered List</button>
  <button onclick="addElement('table')">Table</button>
  <h3>3D Objects</h3>
  <button onclick="add3D('cube')">Cube</button>
  <button onclick="add3D('sphere')">Sphere</button>
  <button onclick="add3D('starfield')">Starfield</button>
  <h3>Actions</h3>
  <button onclick="copyPage()">Copy Full Page HTML</button>
  <button onclick="saveProject()">Save Project</button>
  <button onclick="loadProject()">Load Project</button>
</div>

<!-- CENTER BUILDER -->
<div id="builder"></div>

<!-- RIGHT PANEL: Element Properties -->
<div id="sidePanel">
<h3>Element Properties</h3>
<div id="properties">
<p>Select an element to see properties</p>
</div>
</div>

<!-- THREE.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.min.js"></script>

<script>
let elementCount = 0;
let selectedElement = null;

// ===== DRAG ELEMENT FUNCTION =====
function dragElement(el){
  el.onmousedown = function(e){
    selectedElement = el;
    showProperties(el);
    let shiftX = e.clientX - el.getBoundingClientRect().left;
    let shiftY = e.clientY - el.getBoundingClientRect().top;

    function moveAt(pageX,pageY){
      el.style.left = pageX - shiftX + 'px';
      el.style.top = pageY - shiftY + 'px';
    }
    function onMouseMove(e){ moveAt(e.pageX,e.pageY); }
    document.addEventListener('mousemove', onMouseMove);
    el.onmouseup=function(){ document.removeEventListener('mousemove',onMouseMove); el.onmouseup=null; }
  };
  el.ondragstart=function(){ return false; };
}

// ===== ADD HTML ELEMENT =====
function addElement(type){
  elementCount++;
  const builder = document.getElementById('builder');
  const box = document.createElement('div');
  box.className='element-box';
  box.style.top=(10+elementCount*10)+'px';
  box.style.left=(10+elementCount*10)+'px';

  const removeBtn=document.createElement('button');
  removeBtn.textContent='x';
  removeBtn.className='remove';
  removeBtn.onclick=()=>box.remove();
  box.appendChild(removeBtn);

  let elem;
  switch(type){
    case 'h1': elem=document.createElement('h1'); elem.contentEditable=true; elem.textContent='Heading 1'; break;
    case 'p': elem=document.createElement('p'); elem.contentEditable=true; elem.textContent='This is a paragraph.'; break;
    case 'img': elem=document.createElement('img'); elem.src='https://via.placeholder.com/200x100'; elem.alt='Sample Image'; break;
    case 'button': elem=document.createElement('button'); elem.textContent='Click Me'; elem.onclick=()=>alert('Button clicked!'); break;
    case 'a': elem=document.createElement('a'); elem.href='https://example.com'; elem.target='_blank'; elem.contentEditable=true; elem.textContent='Example Link'; break;
    case 'ul': elem=document.createElement('ul'); elem.innerHTML='<li contenteditable="true">Item 1</li><li contenteditable="true">Item 2</li>'; break;
    case 'ol': elem=document.createElement('ol'); elem.innerHTML='<li contenteditable="true">First</li><li contenteditable="true">Second</li>'; break;
    case 'table': elem=document.createElement('table'); elem.border='1'; elem.innerHTML='<tr><th contenteditable="true">Header 1</th><th contenteditable="true">Header 2</th></tr><tr><td contenteditable="true">Data 1</td><td contenteditable="true">Data 2</td></tr>'; break;
  }

  box.appendChild(elem);
  builder.appendChild(box);
  dragElement(box);

  // Select element on click
  box.onclick=function(){selectedElement=box; showProperties(box);}
}

// ===== ADD 3D ELEMENT =====
function add3D(type){
  const builder = document.getElementById('builder');
  const box = document.createElement('div');
  box.className='element-box';
  box.style.top='50px';
  box.style.left='50px';
  box.style.width='300px';
  box.style.height='300px';

  const removeBtn=document.createElement('button');
  removeBtn.textContent='x';
  removeBtn.className='remove';
  removeBtn.onclick=()=>box.remove();
  box.appendChild(removeBtn);

  const canvasContainer=document.createElement('div');
  box.appendChild(canvasContainer);
  builder.appendChild(box);
  dragElement(box);

  // ===== THREE.JS SETUP =====
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75,1,0.1,1000);
  camera.position.z=5;

  const renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(300,300);
  canvasContainer.appendChild(renderer.domElement);

  const controls=new THREE.OrbitControls(camera,renderer.domElement);
  controls.enableDamping=true;

  // Lights
  const light1=new THREE.DirectionalLight(0xffffff,1);
  light1.position.set(5,5,5); scene.add(light1);
  const light2=new THREE.AmbientLight(0x404040,1.5); scene.add(light2);

  let mesh;
  if(type==='cube'){ 
    const geometry=new THREE.BoxGeometry();
    const material=new THREE.MeshStandardMaterial({color:0x00ff00, metalness:0.5, roughness:0.5});
    mesh=new THREE.Mesh(geometry,material);
    scene.add(mesh);
  }
  if(type==='sphere'){ 
    const geometry=new THREE.SphereGeometry(1,32,32);
    const material=new THREE.MeshStandardMaterial({color:0x0000ff, metalness:0.5, roughness:0.5});
    mesh=new THREE.Mesh(geometry,material);
    scene.add(mesh);
  }
  if(type==='starfield'){
    for(let i=0;i<200;i++){
      const geometry=new THREE.SphereGeometry(0.05,8,8);
      const material=new THREE.MeshBasicMaterial({color:0xffffff});
      const star=new THREE.Mesh(geometry,material);
      star.position.x=Math.random()*20-10;
      star.position.y=Math.random()*20-10;
      star.position.z=Math.random()*20-10;
      scene.add(star);
    }
  }

  // ===== SIDE PANEL CONTROLS =====
  function update3DControls(){
    const panel=document.getElementById('properties');
    panel.innerHTML='';
    if(!mesh) return;

    // Color
    const colorLabel=document.createElement('label'); colorLabel.textContent='Color:';
    const colorInput=document.createElement('input'); colorInput.type='color'; colorInput.value='#'+mesh.material.color.getHexString();
    colorInput.oninput=function(){mesh.material.color.set(this.value);}
    panel.appendChild(colorLabel); panel.appendChild(colorInput);

    // Material type
    const matLabel=document.createElement('label'); matLabel.textContent='Material:';
    const matSelect=document.createElement('select');
    ['Standard','Metal','Phong','Basic','Lambert'].forEach(type=>{
      const opt=document.createElement('option'); opt.value=type; opt.textContent=type;
      matSelect.appendChild(opt);
    });
    matSelect.onchange=function(){
      switch(this.value){
        case 'Standard': mesh.material=new THREE.MeshStandardMaterial({color:mesh.material.color}); break;
        case 'Metal': mesh.material=new THREE.MeshStandardMaterial({color:mesh.material.color, metalness:1, roughness:0}); break;
        case 'Phong': mesh.material=new THREE.MeshPhongMaterial({color:mesh.material.color, shininess:100}); break;
        case 'Basic': mesh.material=new THREE.MeshBasicMaterial({color:mesh.material.color}); break;
        case 'Lambert': mesh.material=new THREE.MeshLambertMaterial({color:mesh.material.color}); break;
      }
    }
    panel.appendChild(matLabel); panel.appendChild(matSelect);

    // Rotation X
    const rotXLabel=document.createElement('label'); rotXLabel.textContent='Rotate X:';
    const rotX=document.createElement('input'); rotX.type='range'; rotX.min=0; rotX.max=6.28; rotX.step=0.01; rotX.value=mesh.rotation.x;
    rotX.oninput=function(){mesh.rotation.x=parseFloat(this.value);}
    panel.appendChild(rotXLabel); panel.appendChild(rotX);

    // Rotation Y
    const rotYLabel=document.createElement('label'); rotYLabel.textContent='Rotate Y:';
    const rotY=document.createElement('input'); rotY.type='range'; rotY.min=0; rotY.max=6.28; rotY.step=0.01; rotY.value=mesh.rotation.y;
    rotY.oninput=function(){mesh.rotation.y=parseFloat(this.value);}
    panel.appendChild(rotYLabel); panel.appendChild(rotY);

    // Scale
    const scaleLabel=document.createElement('label'); scaleLabel.textContent='Scale:';
    const scaleInput=document.createElement('input'); scaleInput.type='range'; scaleInput.min=0.1; scaleInput.max=5; scaleInput.step=0.01; scaleInput.value=mesh.scale.x;
    scaleInput.oninput=function(){mesh.scale.set(this.value,this.value,this.value);}
    panel.appendChild(scaleLabel); panel.appendChild(scaleInput);
  }

  box.onclick=function(){selectedElement=box; update3DControls();}
  
  function animate(){
    requestAnimationFrame(animate);
    if(mesh && type!=='starfield'){ mesh.rotation.x+=0.01; mesh.rotation.y+=0.01; }
    controls.update();
    renderer.render(scene,camera);
  }
  animate();
}

// ===== SHOW PROPERTIES FOR HTML ELEMENTS =====
function showProperties(el){
  const panel=document.getElementById('properties');
  panel.innerHTML='';
  const elem=el.querySelector('*');

  if(elem.contentEditable){
    const label=document.createElement('label'); label.textContent='Text:';
    const input=document.createElement('input'); input.value=elem.textContent;
    input.oninput=function(){elem.textContent=this.value;}
    panel.appendChild(label); panel.appendChild(input);
  }

  if(['H1','P','BUTTON','A'].includes(elem.tagName)){
    const colorLabel=document.createElement('label'); colorLabel.textContent='Color:';
    const colorInput=document.createElement('input'); colorInput.type='color';
    colorInput.oninput=function(){elem.style.color=this.value;}
    panel.appendChild(colorLabel); panel.appendChild(colorInput);
  }

  // Font size
  if(elem.contentEditable){
    const sizeLabel=document.createElement('label'); sizeLabel.textContent='Font Size:';
    const sizeInput=document.createElement('input'); sizeInput.type='number'; sizeInput.value=parseInt(window.getComputedStyle(elem).fontSize);
    sizeInput.oninput=function(){elem.style.fontSize=this.value+'px';}
    panel.appendChild(sizeLabel); panel.appendChild(sizeInput);
  }

  // Background
  const bgLabel=document.createElement('label'); bgLabel.textContent='Background:';
  const bgInput=document.createElement('input'); bgInput.type='color';
  bgInput.oninput=function(){elem.style.backgroundColor=this.value;}
  panel.appendChild(bgLabel); panel.appendChild(bgInput);

  // Padding
  const padLabel=document.createElement('label'); padLabel.textContent='Padding:';
  const padInput=document.createElement('input'); padInput.type='number'; padInput.value=parseInt(window.getComputedStyle(elem).padding);
  padInput.oninput=function(){elem.style.padding=this.value+'px';}
  panel.appendChild(padLabel); panel.appendChild(padInput);

  // Margin
  const marginLabel=document.createElement('label'); marginLabel.textContent='Margin:';
  const marginInput=document.createElement('input'); marginInput.type='number'; marginInput.value=parseInt(window.getComputedStyle(elem).margin);
  marginInput.oninput=function(){elem.style.margin=this.value+'px';}
  panel.appendChild(marginLabel); panel.appendChild(marginInput);
}

// ===== COPY PAGE HTML =====
function copyPage(){
  const builder=document.getElementById('builder');
  const temp=document.createElement('textarea');
  temp.value=builder.innerHTML;
  document.body.appendChild(temp);
  temp.select();
  document.execCommand('copy');
  document.body.removeChild(temp);
  alert('Page HTML copied!');
}

// ===== SAVE / LOAD PROJECT =====
function saveProject(){
  localStorage.setItem('myPageBuilderProject',document.getElementById('builder').innerHTML);
  alert('Project saved!');
}
function loadProject(){
  const data=localStorage.getItem('myPageBuilderProject');
  if(data) document.getElementById('builder').innerHTML=data;
  alert('Project loaded!');
}
</script>
</body>
</html>